{% include 'base.html' %}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="...">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
    <!-- JS Bootstrap, jQuery, Popper.js -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="..."></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="..."></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="..."></script>
    <title>Button Container</title>
</head>

<style>
    .navbar {
        flex-direction: column;
        align-items: flex-start;
        height: 100%;
    }

    .navbar-nav {
        width: 25%;
        text-align: left;
    }

    .navbar-collapse {
        justify-content: flex-start;
    }

    @media (min-width: 576px) {
        .navbar-expand-sm .navbar-toggler {
            display: none;
        }

        .navbar-expand-sm .navbar-nav {
            flex-direction: column;
            width: 30%;
        }

        .navbar-expand-sm .navbar-collapse {
            flex-basis: auto;
            flex-grow: 1;
            align-items: stretch;
        }
    }
</style>
<title>Button Container</title>
</head>
<body>
<nav class="navbar navbar-expand-sm navbar-light" style="background-color: turquoise;">
   
</nav>

<div class="container mt-3">
    <ul class="nav nav-tabs">
        <!-- Tab pentru Stadium -->
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#stadium">Stadium</a>
        </li>
        <!-- Tab pentru Equipment -->
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#equipment">Equipment</a>
        </li>
        <!-- Tab pentru Customer -->
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#customer">Customer</a>
        </li>
    </ul>

    <!-- Conținutul Tab-urilor -->
    <div class="tab-content">
        <!-- Stadium Tab -->
        <div id="stadium" class="container tab-pane active"><br>
            <h3>Stadium Operations</h3>
           
            <form id="add-stadium-form" method="post">
                {% csrf_token %}
                <input type="text" name="name" placeholder="Stadium Name" required>
                <input type="text" name="location" placeholder="Location" required>
                <textarea name="description" placeholder="Description"></textarea>
                <button type="submit">Add Stadium</button>
            </form>
            <form id="update-stadium-form">
                {% csrf_token %}
                <input type="text" name="stadium_id" id="update-stadium-id" placeholder="Stadium Id" required>
                <input type="text" name="name" id="update-stadium-name" placeholder="Stadium Name" required>
                <input type="text" name="location" id="update-stadium-location" placeholder="Location" required>
                <textarea name="description" id="update-stadium-description" placeholder="Description"></textarea>
                <button type="submit">Update Stadium</button>
            </form>
            <table class="table table-striped" id="stadium-table">
                <thead>
                    <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Location</th>
                    <th scope="col">Description</th>

                    </tr>

                </thead>
                <tbody id="stadium-list">
                    <!-- Datele vor fi încărcate aici -->
                </tbody>
            </table>
        </div>

        <!-- Equipment Tab -->
        <div id="equipment" class="container tab-pane fade"><br>
            <h3>Equipment Operations</h3>
            <!-- Formular pentru adăugarea unui echipament -->
            <form id="add-equipment-form" method="post">
                {% csrf_token %}
                <input type="text" name="name" placeholder="Equipment Name" required>
                <input type="text" name="description" placeholder="Description" required>
                <button type="submit">Add Equipment</button>
            </form>
            <!-- Formular pentru actualizarea unui echipament -->
            <form id="update-equipment-form">
                {% csrf_token %}
                <input type="text" name="equipment_id" id="update-equipment-id" placeholder="Equipment Id">
                <input type="text" name="name" id="update-equipment-name" placeholder="Equipment Name" required>
                <textarea name="description" id="update-equipment-description" placeholder="Description"></textarea>
                <button type="submit">Update Equipment</button>
            </form>
            <table class="table table-striped" id="equipment-table">
                <thead>
                    <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Description</th>
                    </tr>
                </thead>
                <tbody id="equipment-list">
                    <!-- Datele vor fi încărcate aici -->
                </tbody>
            </table>
        </div>
    
        <!-- Customer Tab -->
        <div id="customer" class="container tab-pane fade"><br>
            <h3>Customer Operations</h3>
            <!-- Formulare pentru operațiuni pe clienți -->
            <form id="update-customer-form">
                {% csrf_token %}
                <input type="text" name="customer_id" id="update-customer-id" placeholder="id" required>
                <input type="text" name="username" id="update-customer-username" placeholder="username" required>
                <input type="text" name="firstname" id="update-customer-firstname" placeholder="First Name" required>
                <input type="text" name="lastname" id="update-customer-lastname" placeholder="Last Name" required>
                <input type="text" name="wallet_balance" id="update-customer-wallet_balance" placeholder="Wallet Balance" required>
                <input type="text" name="address" id="update-customer-address" placeholder="Address">
                <input type="text" name="phone" id="update-customer-phone" placeholder="Phone">
                <button type="submit">Update Customer</button>
            </form>  
            <form id="add-customer-form">
                {% csrf_token %}
                <input type="text" name="username" id="add-customer-username" placeholder="username" required>
                <input type="text" name="firstname" id="add-customer-firstname" placeholder="First Name" required>
                <input type="text" name="lastname" id="add-customer-lastname" placeholder="Last Name" required>
                <input type="text" name="wallet_balance" id="add-customer-wallet_balance" placeholder="Wallet Balance" required>
                <input type="text" name="address" id="add-customer-address" placeholder="Address">
                <input type="text" name="phone" id="add-customer-phone" placeholder="Phone">
                <button type="submit">Add Customer</button>
            </form>  
            <table class="table table-striped" id="customer-table">
                <thead>
                    <th scope="col">#</th>
                    <th scope="col">username</th>
                    <th scope="col">firstname</th>
                    <th scope="col">lastname</th>
                    <th scope="col">wallet_balance</th>
                    <th scope="col">address</th>
                    <th scope="col">phone</th>
                </thead>
                <tbody id="customer-list">
                    <!-- Datele vor fi încărcate aici -->
                </tbody>
            </table>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Pentru stadion
    function getCsrfToken() {
        return document.querySelector('[name=csrfmiddlewaretoken]').value;
    }
    $("#add-stadium-form").submit(function(e) {
    e.preventDefault();
    $.ajax({
        type: "POST",
        url: "/add_stadium/", // URL-ul definit în urls.py
        data: $(this).serialize() + "&csrfmiddlewaretoken=" + getCsrfToken(),
        success: function(response) {
            alert("Success adding stadium!");
            refreshStadiumList(); // Actualizează lista
            $("#add-stadium-form")[0].reset();  // Resetează formularul

        },
        error: function(response) {
            // Gestionarea erorilor
        }
    });
});

$("#update-stadium-form").submit(function(e) {
    e.preventDefault();
    $.ajax({
        type: "POST",
        url: "/update_stadium/", // URL-ul pentru actualizare
        data: $(this).serialize(),
        success: function(response) {
            alert("Success updating stadium!");
            refreshStadiumList(); // Actualizează lista
            $("#update-stadium-form")[0].reset();  // Resetează formularul

        },
        error: function(response) {
            // Gestionați erorile
        }
    });
});

    // Pentru echipament
    $("#add-equipment-form").submit(function(e) {
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/add_equipment/", // URL-ul definit în urls.py
            data: $(this).serialize(),
            success: function(response) {
            },
            error: function(response) {
                // Gestionarea erorilor
            }
        });
    });

    
    $("#update-equipment-form").submit(function(e) {
    e.preventDefault();
    $.ajax({
        type: "POST",
        url: "/update_equipment/", // URL-ul pentru actualizare
        data: $(this).serialize(),
        success: function(response) {
            // Gestionați răspunsul (ex. ascundeți formularul și actualizați lista stadionului)
            $('#update_equipment-section').hide();
        },
        error: function(response) {
            // Gestionați erorile
            alert("Error updating equipment");
        }
    });
});

$("#update-customer-form").submit(function(e) {
    e.preventDefault();

    $.ajax({
        type: "POST",
        url: "/update_customer/", // Asigurați-vă că URL-ul este corect
        data: $(this).serialize(),
        success: function(response) {
            // Gestionarea răspunsului pozitiv, de exemplu, afișarea unui mesaj de succes
            refreshCustomerList();
        },
        error: function(response) {
            // Gestionarea erorilor, de exemplu, afișarea unui mesaj de eroare
            alert("Error updating customer");
        }
    });
}); 

$("#add-customer-form").submit(function(e) {
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/add_customer/", // URL-ul definit în urls.py
            data: $(this).serialize(),
            success: function(response) {
                refreshCustomerList();
            },
            error: function(response) {
                // Gestionarea erorilor
                alert("Error adding customer");

            }
        });
    });

    function deleteStadium(id) {
    if(confirm("Are you sure you want to delete this stadium?")) {
        $.ajax({
            type: "POST",
            url: "/delete_stadium/" + id + "/",  // asigurați-vă că URL-ul este corect
            data: {
                'id': id,
                'csrfmiddlewaretoken': getCsrfToken()  // presupunând că aveți o funcție care extrage token-ul CSRF
            },
            success: function(response) {
                alert("Stadium deleted successfully!");
                refreshStadiumList();
            },
            error: function(xhr) {
                alert("Error deleting stadium: " + xhr.responseText);
            }
        });
    }
}

function refreshStadiumList() {
    $.ajax({
        url: "/stadium_list/",
        type: "GET",
        success: function(data) {
            var stadiumList = $('#stadium-list');
            stadiumList.empty();
            data.forEach(function(stadium, index) {
                stadiumList.append(
                    `<tr>
                        <th scope="row">${index + 1}</th>
                        <td>${stadium.name}</td>
                        <td>${stadium.location}</td>
                        <td>${stadium.description}</td>
                        <td>
                            <button onclick="deleteStadium(${stadium.id})" class="btn btn-danger">Delete</button>
                        </td>
                    </tr>`
                );
            }); 
        },
        error: function(xhr) {
            console.error("Error loading stadiums: " + xhr.responseText);
        }
    });
}


function deleteEquipment(id) {
    if(confirm("Are you sure you want to delete this Equipment?")) {
        $.ajax({
            type: "POST",
            url: "/delete_equipment/" + id + "/",  // asigurați-vă că URL-ul este corect
            data: {
                'id': id,
                'csrfmiddlewaretoken': getCsrfToken()  // presupunând că aveți o funcție care extrage token-ul CSRF
            },
            success: function(response) {
                alert("Equipment deleted successfully!");
                refreshEquipmentList()
            },
            error: function(xhr) {
                alert("Error deleting equipment: " + xhr.responseText);
            }
        });
    }
}




function refreshEquipmentList() {
    $.ajax({
        url: "/equipment_list/",
        type: "GET",
        success: function(data) {
            var equipmentList = $('#equipment-list');
            equipmentList.empty();
            data.forEach(function(equipment, index) {
                equipmentList.append(
                    `<tr>
                        <th scope="row">${index + 1}</th>
                        <td>${equipment.name}</td>
                        <td>${equipment.description}</td>
                        <td>
                            <button onclick="deleteEquipment(${equipment.id})" class="btn btn-danger">Delete</button>
                        </td>
                    </tr>`
                );
            });
        },
        error: function(response) {
            alert("Error loading equipment: " + response.responseText);
        }
    });
}


function deleteCustomer(id) {
    if(confirm("Are you sure you want to delete this Customer?")) {
        $.ajax({
            type: "POST",
            url: "/delete_customer/" + id + "/",
            data: {
                'id': id,
                'csrfmiddlewaretoken': getCsrfToken()
            },
            success: function(response) {
                alert("Customer deleted successfully!");
                refreshCustomerList();
            },
            error: function(xhr) {
                alert("Error deleting customer: " + xhr.responseText);
            }
        });
    }
}

function refreshCustomerList() {
    $.ajax({
        url: "/customer_list/",
        type: "GET",
        success: function(data) {
            var customerList = $('#customer-list');
            customerList.empty();
            data.forEach(function(customer, index) {
                customerList.append(
                    `<tr>
                        <th scope="row">${index + 1}</th>
                        <td>${customer.user__username}</td>
                        <td>${customer.firstname}</td>
                        <td>${customer.lastname}</td>
                        <td>${customer.wallet_balance}</td>
                        <td>${customer.address}</td>
                        <td>${customer.phone}</td>
                        <td>
                            <button onclick="deleteCustomer(${customer.id})" class="btn btn-danger">Delete</button>
                        </td>
                    </tr>`
                );
            });
        },
        error: function(response) {
            alert("Error loading customers: " + response.responseText);
        }
    });
}
function updateTabContent(activeTab) {
    $('#stadium').hide();
    $('#equipment').hide();
    $('#customer').hide();

    $(activeTab).show();
}

$(document).ready(function() {
    refreshStadiumList();
    refreshEquipmentList();
    refreshCustomerList();
    // Ascultător pentru schimbarea tab-ului
    $('a[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
        var activeTab = $(e.target).attr('href'); // Tab-ul activ
        updateTabContent(activeTab);
    });

    // Inițializare - afișați doar conținutul tab-ului activ
    updateTabContent('.tab-pane.active');
});

function getCsrfToken() {
    return document.querySelector('input[name="csrfmiddlewaretoken"]').value;
}

</script>

</body>
</html>